<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mz.system.provider.dao.SysRoleDao">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.mz.system.model.entity.SysRoleEntity" id="sysRoleMap">
        <result property="roleId" column="role_id"/>
        <result property="roleName" column="role_name"/>
        <result property="roleKey" column="role_key"/>
        <result property="roleSort" column="role_sort"/>
        <result property="dataScope" column="data_scope"/>
        <result property="menuCheckStrictly" column="menu_check_strictly"/>
        <result property="deptCheckStrictly" column="dept_check_strictly"/>
        <result property="status" column="STATUS"/>
        <result property="delFlag" column="del_flag"/>
        <result property="createBy" column="create_by"/>
        <result property="createTime" column="create_time"/>
        <result property="updateBy" column="update_by"/>
        <result property="updateTime" column="update_time"/>
        <result property="remark" column="remark"/>
    </resultMap>

    <sql id = "fromHead">
        `role_id`,`role_name`,`role_key`,`role_sort`,`data_scope`,`menu_check_strictly`,`dept_check_strictly`,`status`,`del_flag`,`create_by`,`create_time`,`update_by`,`update_time`,`remark`
    </sql>

    <sql id="whereSelect">
        <where>
            <if test = "data.roleId != null and data.roleId.toString() != '0'">
                and t.role_id = #{data.roleId}
            </if>
            <if test = "data.roleName != null and data.roleName.toString() != ''">
                and t.role_name = #{data.roleName}
            </if>
            <if test = "data.roleKey != null and data.roleKey.toString() != ''">
                and t.role_key = #{data.roleKey}
            </if>
            <if test = "data.roleSort != null and data.roleSort.toString() != '0'">
                and t.role_sort = #{data.roleSort}
            </if>
            <if test = "data.dataScope != null and data.dataScope.toString() != ''">
                and t.data_scope = #{data.dataScope}
            </if>
            <if test = "data.menuCheckStrictly != null and data.menuCheckStrictly.toString() != '0'">
                and t.menu_check_strictly = #{data.menuCheckStrictly}
            </if>
            <if test = "data.deptCheckStrictly != null and data.deptCheckStrictly.toString() != '0'">
                and t.dept_check_strictly = #{data.deptCheckStrictly}
            </if>
            <if test = "data.status != null and data.status.toString() != ''">
                and t.status = #{data.status}
            </if>
            <if test = "data.delFlag != null and data.delFlag.toString() != ''">
                and t.del_flag = #{data.delFlag}
            </if>
            <if test = "data.createBy != null and data.createBy.toString() != ''">
                and t.create_by = #{data.createBy}
            </if>
            <if test = "data.createTime != null and data.createTime.toString() != ''">
                and t.create_time = #{data.createTime}
            </if>
            <if test = "data.updateBy != null and data.updateBy.toString() != ''">
                and t.update_by = #{data.updateBy}
            </if>
            <if test = "data.updateTime != null and data.updateTime.toString() != ''">
                and t.update_time = #{data.updateTime}
            </if>
            <if test = "data.remark != null and data.remark.toString() != ''">
                and t.remark = #{data.remark}
            </if>
        </where>
    </sql>

    <select id = "getRolePermissions" resultType = "java.lang.String">
        select sr.role_key
        from sys_role sr
        left join sys_user_role sur on sur.role_id = sr.role_id
        where sur.user_id = #{userid}
    </select>

    <select id = "isRole" resultType = "java.lang.Boolean">
            select if ( count( 1 ) > 0, true, false ) as isRole
            from sys_role sr
            left join sys_user_role sur on sur.role_id = sr.role_id
            where sur.user_id = #{userId} and sr.status = 0
                and sr.del_flag = 0 and sr.role_key = #{roleKey}
    </select>

</mapper>